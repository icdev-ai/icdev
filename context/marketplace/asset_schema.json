{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ICDEV Marketplace Asset Schema",
  "description": "Extended GOTCHA asset schema with Gov/DoD classification, compliance, and provenance fields for the ICDEV Federated Marketplace.",
  "type": "object",
  "required": ["name", "version", "description", "asset_type", "classification", "impact_level"],
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^[a-z0-9][a-z0-9-]{1,62}[a-z0-9]$",
      "maxLength": 64,
      "description": "Unique asset name (lowercase, hyphens, 3-64 chars)"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$",
      "description": "Semantic version (e.g., 1.2.3, 1.0.0-rc.1)"
    },
    "description": {
      "type": "string",
      "maxLength": 1024,
      "description": "Human-readable description of the asset"
    },
    "asset_type": {
      "type": "string",
      "enum": ["skill", "goal", "hardprompt", "context", "args", "compliance"],
      "description": "GOTCHA layer this asset belongs to"
    },
    "classification": {
      "type": "string",
      "enum": [
        "UNCLASSIFIED",
        "CUI // SP-CTI",
        "CUI // SP-EXPT",
        "CUI // SP-NNPI",
        "SECRET // NOFORN",
        "SECRET // REL TO USA, FVEY"
      ],
      "description": "CUI/classification marking for the asset"
    },
    "impact_level": {
      "type": "string",
      "enum": ["IL2", "IL4", "IL5", "IL6"],
      "description": "Minimum impact level required to consume this asset"
    },
    "compliance_controls": {
      "type": "array",
      "items": { "type": "string" },
      "description": "NIST 800-53 control IDs this asset addresses (e.g., AC-2, AU-3)"
    },
    "provenance": {
      "type": "object",
      "properties": {
        "publisher_org": {
          "type": "string",
          "description": "Organization that published this asset"
        },
        "publisher_tenant": {
          "type": "string",
          "description": "Tenant UUID of the publishing organization"
        },
        "author": {
          "type": "string",
          "description": "Individual author identifier (e.g., CAC CN)"
        },
        "signed_by": {
          "type": "string",
          "description": "Identity that signed the asset (e.g., john.doe.1234567890@mil)"
        },
        "signature": {
          "type": "string",
          "description": "RSA-SHA256 base64-encoded signature"
        },
        "sbom_id": {
          "type": "string",
          "description": "SBOM record ID for this asset version"
        }
      }
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["slug", "version"],
        "properties": {
          "slug": {
            "type": "string",
            "description": "Asset slug (publisher/name format)"
          },
          "version": {
            "type": "string",
            "description": "Version constraint (e.g., >=1.0.0, ~1.2.0, 2.0.0)"
          }
        }
      },
      "description": "Other marketplace assets this asset depends on"
    },
    "allowed_tools": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Tools this skill is permitted to use (skills only)"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string", "maxLength": 32 },
      "maxItems": 10,
      "description": "Searchable tags for discovery"
    },
    "license": {
      "type": "string",
      "description": "License identifier (e.g., MIT, Apache-2.0, USG-INTERNAL)"
    },
    "supported_languages": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["python", "java", "javascript", "typescript", "go", "rust", "csharp"]
      },
      "description": "Programming languages this asset supports (if applicable)"
    },
    "min_icdev_version": {
      "type": "string",
      "description": "Minimum ICDEV platform version required"
    },
    "changelog": {
      "type": "string",
      "maxLength": 4096,
      "description": "Changelog for this version"
    },
    "deprecated": {
      "type": "boolean",
      "default": false,
      "description": "Whether this asset version is deprecated"
    },
    "replacement_slug": {
      "type": "string",
      "description": "Slug of the replacement asset (if deprecated)"
    }
  }
}
