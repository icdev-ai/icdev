# [TEMPLATE: CUI // SP-CTI]
# ICDEV SIEM Configuration — Splunk Universal Forwarder
# Per DoD Instruction 8530.01 — CSSP Log Forwarding Requirements
#
# Template variables:
#   {{system_name}}          - System name
#   {{splunk_server}}        - Splunk indexer/HEC endpoint
#   {{splunk_port}}          - Splunk receiving port (default 9997)
#   {{splunk_hec_token}}     - HTTP Event Collector token (from Secrets Manager)
#   {{splunk_index}}         - Target index name
#   {{ssl_cert_path}}        - Path to client certificate
#   {{ssl_key_path}}         - Path to client private key
#   {{ssl_ca_path}}          - Path to CA certificate bundle
#   {{app_log_path}}         - Application log directory
#   {{auth_log_path}}        - Authentication log directory
#   {{project_dir}}          - Project root directory

# =============================================================================
# outputs.conf — Forward logs to CSSP Splunk indexer
# =============================================================================

[tcpout]
defaultGroup = cssp_indexers
disabled = false

[tcpout:cssp_indexers]
server = {{splunk_server}}:{{splunk_port}}
compressed = true
sslCertPath = {{ssl_cert_path}}
sslPassword = {{ssl_key_password}}
sslRootCAPath = {{ssl_ca_path}}
sslVerifyServerCert = true
sslCommonNameToCheck = {{splunk_server}}
useACK = true

# =============================================================================
# inputs.conf — Define log sources per DI 8530.01 requirements
# =============================================================================

# Application Logs (DE-2, DE-3)
[monitor://{{app_log_path}}/*.log]
disabled = false
index = {{splunk_index}}
sourcetype = icdev:application
host = {{system_name}}
_meta = classification::CUI environment::govcloud system::{{system_name}}

# Authentication Events (DE-3, PR-1)
[monitor://{{auth_log_path}}/auth*.log]
disabled = false
index = {{splunk_index}}
sourcetype = icdev:authentication
host = {{system_name}}
_meta = classification::CUI event_category::authentication

# Security Events (DE-3, DE-4)
[monitor://{{app_log_path}}/security*.log]
disabled = false
index = {{splunk_index}}
sourcetype = icdev:security
host = {{system_name}}
_meta = classification::CUI event_category::security

# Audit Trail (AU-2, AU-3, AU-12)
[monitor://{{app_log_path}}/audit*.log]
disabled = false
index = {{splunk_index}}
sourcetype = icdev:audit
host = {{system_name}}
_meta = classification::CUI event_category::audit

# System Logs (DE-1)
[monitor:///var/log/syslog]
disabled = false
index = {{splunk_index}}
sourcetype = syslog
host = {{system_name}}

[monitor:///var/log/messages]
disabled = false
index = {{splunk_index}}
sourcetype = syslog
host = {{system_name}}

# Container/K8s Logs (DE-2)
[monitor:///var/log/containers/*.log]
disabled = false
index = {{splunk_index}}
sourcetype = kube:container:log
host = {{system_name}}
_meta = classification::CUI event_category::container

# Network Events (DE-5, SC-7)
[monitor://{{app_log_path}}/network*.log]
disabled = false
index = {{splunk_index}}
sourcetype = icdev:network
host = {{system_name}}
_meta = classification::CUI event_category::network

# =============================================================================
# props.conf — Field extractions and timestamp parsing
# =============================================================================

[icdev:application]
TIME_FORMAT = %Y-%m-%dT%H:%M:%S
MAX_TIMESTAMP_LOOKAHEAD = 30
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)
TRUNCATE = 10000

[icdev:authentication]
TIME_FORMAT = %Y-%m-%dT%H:%M:%S
SHOULD_LINEMERGE = false
EXTRACT-user = user=(?<user>[^\s]+)
EXTRACT-action = action=(?<action>[^\s]+)
EXTRACT-result = result=(?<result>[^\s]+)

[icdev:security]
TIME_FORMAT = %Y-%m-%dT%H:%M:%S
SHOULD_LINEMERGE = false
EXTRACT-severity = severity=(?<severity>[^\s]+)
EXTRACT-event_type = event_type=(?<event_type>[^\s]+)

[icdev:audit]
TIME_FORMAT = %Y-%m-%dT%H:%M:%S
SHOULD_LINEMERGE = false
EXTRACT-actor = actor=(?<actor>[^\s]+)
EXTRACT-action = action=(?<action>[^\s]+)
EXTRACT-project = project_id=(?<project_id>[^\s]+)

# [TEMPLATE: CUI // SP-CTI]
