{% extends "portal_base.html" %}
{% block title %}Translations — {{ tenant_name }}{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('portal.portal_home') }}">Home</a> &gt; <span>Translations</span>
</div>

<h1>Cross-Language Translation</h1>
<p class="text-muted">LLM-assisted code translation across 30 language pairs with ATO compliance preservation.</p>

<!-- Stat Cards -->
<div class="stat-grid">
    <div class="stat-card">
        <div class="stat-value">{{ total }}</div>
        <div class="stat-label">Total Jobs</div>
    </div>
    <div class="stat-card stat-card--success">
        <div class="stat-value">{{ completed }}</div>
        <div class="stat-label">Completed</div>
    </div>
    <div class="stat-card stat-card--warning">
        <div class="stat-value">{{ in_progress }}</div>
        <div class="stat-label">In Progress</div>
    </div>
    <div class="stat-card stat-card--danger">
        <div class="stat-value">{{ failed }}</div>
        <div class="stat-label">Failed / Partial</div>
    </div>
    {% if avg_api_score is not none %}
    <div class="stat-card">
        <div class="stat-value">{{ avg_api_score }}%</div>
        <div class="stat-label">Avg API Surface</div>
    </div>
    {% endif %}
</div>

<!-- Jobs Table -->
<div class="table-container">
    <h3>Translation Jobs</h3>
    {% if jobs %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Job ID</th>
                <th>Language Pair</th>
                <th>Status</th>
                <th>Units</th>
                <th>Gate</th>
                <th>Duration</th>
                <th>Created</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs %}
            <tr>
                <td><a href="{{ url_for('portal.translation_detail', job_id=job.id) }}">{{ job.id[:8] }}…</a></td>
                <td>{{ job.source_language }} → {{ job.target_language }}</td>
                <td>
                    {% if job.status == 'completed' %}
                    <span class="badge badge-success">Completed</span>
                    {% elif job.status in ('pending', 'extracting', 'translating', 'assembling', 'validating') %}
                    <span class="badge badge-warning">{{ job.status|capitalize }}</span>
                    {% elif job.status == 'partial' %}
                    <span class="badge badge-warning">Partial</span>
                    {% else %}
                    <span class="badge badge-danger">{{ job.status|capitalize }}</span>
                    {% endif %}
                </td>
                <td>{{ job.translated_units or 0 }}/{{ job.total_units or 0 }}
                    {% if job.mocked_units %}<small>({{ job.mocked_units }} mocked)</small>{% endif %}
                </td>
                <td>
                    {% if job.gate_result == 'pass' %}
                    <span class="badge badge-success">Pass</span>
                    {% elif job.gate_result == 'warn' %}
                    <span class="badge badge-warning">Warn</span>
                    {% elif job.gate_result == 'fail' %}
                    <span class="badge badge-danger">Fail</span>
                    {% else %}—{% endif %}
                </td>
                <td>{% if job.elapsed_seconds %}{{ "%.1f"|format(job.elapsed_seconds) }}s{% else %}—{% endif %}</td>
                <td>{{ job.created_at or '—' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <h3>No Translation Jobs Yet</h3>
        <p>Use the translation pipeline to translate code between languages.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
