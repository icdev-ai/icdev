# CUI // SP-CTI
# ICDEV GovCon Intelligence Configuration — Phase 59
# SAM.gov opportunity scanning, requirement mining, capability mapping, proposal automation

# =========================================================================
# SAM.gov Opportunities API
# =========================================================================
sam_gov:
  api_url: https://api.sam.gov/opportunities/v2/search
  api_key_env: SAM_GOV_API_KEY
  poll_interval_hours: 6
  rate_limit:
    requests_per_second: 10
    daily_limit: 10000
    delay_between_requests: 0.15
  naics_codes:
    - "541512"    # Computer Systems Design Services
    - "541511"    # Custom Computer Programming Services
    - "541519"    # Other Computer Related Services
    - "518210"    # Data Processing, Hosting, and Related Services
    - "541513"    # Computer Facilities Management Services
    - "541330"    # Engineering Services
    - "541611"    # Administrative Management Consulting
    - "541690"    # Other Scientific and Technical Consulting
  notice_types:
    - "o"         # Solicitation
    - "p"         # Pre-solicitation
    - "r"         # Sources Sought / RFI
    - "k"         # Combined Synopsis/Solicitation
  award_notice_types:
    - "a"         # Award Notice
    - "i"         # Intent to Bundle
  lookback_days: 30
  max_per_poll: 100
  description_max_chars: 10000

# =========================================================================
# Requirement Extraction (D362 — deterministic regex)
# =========================================================================
requirement_extraction:
  shall_patterns:
    - "shall"
    - "must"
    - "is required to"
    - "will provide"
    - "will deliver"
    - "will maintain"
    - "will ensure"
    - "will demonstrate"
    - "will comply"
    - "will support"
  domain_categories:
    devsecops:
      keywords: [DevSecOps, CI/CD, pipeline, continuous integration, continuous delivery,
                 continuous deployment, automated testing, test automation, build automation,
                 code review, merge request, pull request, GitLab, GitHub, Jenkins]
    ai_ml:
      keywords: [artificial intelligence, machine learning, AI/ML, GenAI, generative AI,
                 large language model, LLM, neural network, deep learning, model training,
                 model card, responsible AI, AI governance, AI ethics, AI RMF, AI bias,
                 natural language processing, NLP, computer vision, MLOps]
    ato_rmf:
      keywords: [ATO, authority to operate, RMF, risk management framework, NIST 800-53,
                 FedRAMP, cATO, continuous ATO, continuous authorization, SSP,
                 system security plan, POAM, plan of action, eMASS, OSCAL,
                 security assessment report, SAR, authorization boundary]
    cloud:
      keywords: [cloud, AWS, Azure, GCP, cloud migration, cloud modernization,
                 SaaS, PaaS, IaaS, GovCloud, IL4, IL5, IL6, containerization,
                 Kubernetes, Docker, microservices, serverless, cloud native]
    security:
      keywords: [cybersecurity, zero trust, ZTA, STIG, SCAP, vulnerability,
                 penetration testing, threat modeling, SAST, DAST, IAST,
                 secret detection, container scanning, supply chain security,
                 SBOM, software bill of materials, incident response]
    compliance:
      keywords: [CMMC, FedRAMP, FISMA, DFARS, NIST 800-53, NIST 800-171,
                 CJIS, HIPAA, HITRUST, SOC 2, PCI DSS, ISO 27001,
                 compliance automation, compliance monitoring, audit trail]
    agile:
      keywords: [agile, scrum, SAFe, Scaled Agile, sprint, backlog, kanban,
                 JIRA, user story, epic, feature, PI planning, program increment,
                 agile at scale, DevOps, lean]
    data:
      keywords: [data analytics, data lake, data warehouse, ETL, data pipeline,
                 business intelligence, BI, big data, data engineering,
                 data governance, data quality, master data management]
    management:
      keywords: [project management, PMP, earned value, EVMS, WBS,
                 CDRL, contract deliverable, SLA, service level,
                 transition plan, quality assurance, quality control,
                 configuration management, change management, ITIL]
  min_pattern_frequency: 3
  clustering:
    min_shared_keywords: 3
    similarity_threshold: 0.6

# =========================================================================
# Capability Mapping (D363)
# =========================================================================
capability_mapping:
  catalog_path: context/govcon/icdev_capability_catalog.json
  min_keyword_overlap: 2
  min_coverage_for_compliant: 0.80    # L in compliance matrix
  min_coverage_for_partial: 0.40      # M in compliance matrix
  # below 0.40 = N (non-compliant / gap)

# =========================================================================
# Response Drafting (D365 — two-tier LLM)
# =========================================================================
response_drafting:
  llm_function: proposal_drafting
  max_draft_length_words: 500
  include_evidence: true
  include_tool_references: true
  confidence_threshold: 0.70
  max_knowledge_blocks_per_draft: 3
  # Product-level response detection: when a requirement mentions 2+ product
  # trigger keywords, the drafter uses whole-product templates/context instead
  # of individual capability templates
  product_detection:
    enabled: true
    min_keyword_matches: 2
    products:
      - icdev_platform
      - contract_management_portal

# =========================================================================
# Award Tracking (D367)
# =========================================================================
award_tracking:
  enabled: true
  poll_interval_hours: 24
  lookback_days: 90
  auto_create_competitor: true

# =========================================================================
# Knowledge Base (D368)
# =========================================================================
knowledge_base:
  max_blocks_per_draft: 3
  keyword_search_top_k: 5
  track_usage: true
  categories:
    - capability_description   # Individual capability technical description
    - approach                 # Implementation methodology
    - staffing                 # Team structure and qualifications
    - tools_used               # Specific tools within a capability
    - past_performance         # Client reference / performance evidence
    - differentiator           # Competitive advantage
    - management_approach      # Project management methodology
    - transition_plan          # Deployment / transition approach
    - product_overview         # Whole-product description (ICDEV, CPMP)
    - integrated_solution      # How products integrate end-to-end
    - customer_value           # Benefits and ROI for government customers

# =========================================================================
# Business Model (D372)
# =========================================================================
business_model:
  default_licensing: tbd
  licensing_options:
    - on_prem_free       # winning customers get ICDEV free on-prem
    - saas_paid          # other bidders pay SaaS pricing
    - negotiated         # custom terms
    - tbd                # not yet decided

  # D374 — Customer Delivery Tier → Deployment Profile mapping
  # When a proposal is won with on_prem_free, the delivery_tier determines
  # which deployment profile from deployment_profiles.yaml is used.
  delivery_tiers:
    core:
      profile: customer_core
      description: "SDLC essentials — builder, security, testing, compliance, CI/CD, dashboard"
      modules: 8
      recommended_for: "Task order deliverables, simple compliance automation"
    standard:
      profile: customer_standard
      description: "Full DevSecOps — adds ZTA, RICOAS intake, infrastructure, monitoring"
      modules: 12
      recommended_for: "Program-level delivery, DevSecOps transformation contracts"
    enterprise:
      profile: customer_enterprise
      description: "Complete engineering suite — adds MBSE, modernization, gateway, multi-agent"
      modules: 18
      recommended_for: "Enterprise-wide digital transformation, MDAP programs"
  default_delivery_tier: standard

  # Components NEVER included in customer delivery (internal business tools)
  internal_only_components:
    - govcon           # SAM.gov scanning, requirement mining, competitive intel
    - creative         # Competitor gap analysis, pain point extraction
    - innovation       # Self-improvement engine, web intelligence
    - govproposal      # Proposal writing, RFX AI drafting, color reviews
    - saas             # Multi-tenant SaaS platform layer
    - marketplace_admin  # Marketplace administration (customers consume, not run)

# =========================================================================
# Innovation / Creative Engine Cross-Registration (D361)
# =========================================================================
cross_registration:
  innovation_engine:
    enabled: true
    signal_category: govcon_opportunity
    min_score_for_registration: 0.50
  creative_engine:
    enabled: true
    signal_source_type: sam_gov_rfp

# =========================================================================
# Scheduling
# =========================================================================
scheduling:
  daemon_mode: true
  opportunity_scan_interval_hours: 6
  award_scan_interval_hours: 24
  pattern_clustering_interval_hours: 12
  quiet_hours:
    start: "02:00"
    end: "06:00"
    timezone: UTC

# =========================================================================
# Contract Performance Management Portal — Phase 60 (D-CPMP-1 through D-CPMP-10)
# Post-award contract lifecycle: EVM, CPARS, CDRL, subcontractors, COR portal
# =========================================================================
cpmp:
  # Contract health scoring weights (D-CPMP-8 — deterministic weighted average, D21)
  health_weights:
    evm: 0.30
    deliverables: 0.25
    cpars: 0.20
    negative_events: 0.15
    funding: 0.10

  # Contract status transitions (state machine)
  contract_transitions:
    draft: [active]
    active: [option_pending, complete, terminated]
    option_pending: [active, complete, terminated]
    complete: [closed]
    closed: []
    terminated: [closed]

  # Deliverable status transitions (state machine)
  deliverable_transitions:
    not_started: [in_progress]
    in_progress: [draft_complete, overdue]
    draft_complete: [internal_review]
    internal_review: [submitted, in_progress]
    submitted: [government_review]
    government_review: [accepted, rejected]
    accepted: []
    rejected: [resubmitted]
    resubmitted: [government_review]
    overdue: [in_progress, submitted]

  # EVM configuration (ANSI/EIA-748, D-CPMP-2)
  evm:
    cpi_yellow_threshold: 0.95
    cpi_red_threshold: 0.85
    spi_yellow_threshold: 0.95
    spi_red_threshold: 0.85
    monte_carlo_iterations: 10000
    forecast_confidence_levels: [0.50, 0.80, 0.95]

  # CPARS prediction (D-CPMP-3 — deterministic weighted scoring)
  cpars:
    prediction_weights:
      quality: 0.25
      schedule: 0.25
      cost: 0.20
      management: 0.15
      small_business: 0.15
    rating_thresholds:
      exceptional: 0.90
      very_good: 0.75
      satisfactory: 0.60
      marginal: 0.40
      # below 0.40 = unsatisfactory
    corrective_action_discount: 0.50   # completed corrective actions reduce penalty by 50%

  # NDAA negative-event auto-detection rules
  negative_events:
    auto_detect:
      delinquent_delivery:
        enabled: true
        trigger: "deliverable.days_overdue > 0"
      cost_overrun:
        enabled: true
        trigger: "evm.cpi < 0.85 for 3 consecutive periods"
      quality_rejection:
        enabled: true
        trigger: "deliverable.rejection_count >= 2"
      flowdown_failure:
        enabled: true
        trigger: "subcontractor.subcontract_value > 100000 AND flow_down_complete = 0"
      cybersecurity_breach:
        enabled: true
        trigger: "subcontractor.cybersecurity_compliant = 0 AND days_since_flag > 30"
    # NDAA penalty table (per-event-type CPARS impact)
    penalty_table:
      delinquent_delivery: 0.05
      cost_overrun: 0.08
      quality_rejection: 0.06
      cybersecurity_breach: 0.10
      flowdown_failure: 0.04
      safety_violation: 0.12
      compliance_violation: 0.06
      cure_notice: 0.15
      show_cause: 0.20
      stop_work: 0.25
      termination_default: 0.50
      fraud_waste_abuse: 0.50

  # CDRL auto-generation (D-CPMP-5 — dispatches to ICDEV tools)
  cdrl:
    output_dir: data/cdrl_output
    auto_generate_days_before_due: 14
    tool_mapping:
      ssp: tools/compliance/ssp_generator.py
      sbom: tools/compliance/sbom_generator.py
      poam: tools/compliance/poam_generator.py
      stig_checklist: tools/compliance/stig_checker.py
      evm_report: tools/govcon/evm_engine.py
      icd: tools/mosa/icd_generator.py
      tsp: tools/mosa/tsp_generator.py
      test_report: tools/testing/test_orchestrator.py
      security_scan: tools/security/sast_runner.py

  # SAM.gov Contract Awards API (D-CPMP-6)
  sam_awards:
    api_url: https://api.sam.gov/opportunities/v1/search
    api_key_env: SAM_GOV_API_KEY
    poll_interval_hours: 24
    rate_limit:
      requests_per_second: 10
      delay_between_requests: 0.15
    lookback_days: 90

  # COR Portal (D-CPMP-4)
  cor_portal:
    enabled: true
    session_timeout_minutes: 30
    hidden_fields:
      - subcontractor_pricing
      - internal_cost_details
      - internal_notes
      - corrective_action_details
      - billed_value
      - ac_cumulative

# =========================================================================
# Questions to Government (D-QTG-1 through D-QTG-5)
# Strategic question generation, amendment tracking, Q&A lifecycle
# =========================================================================
questions_to_government:
  # Category weights for priority scoring (D-QTG-1, D21 pattern)
  category_weights:
    scope: 3.0
    evaluation_criteria: 2.8
    technical_requirements: 2.5
    contract_terms: 2.0
    compliance_security: 1.8
    small_business: 1.5

  # Priority thresholds (score = category_weight * ambiguity_level * strategic_value)
  priority_thresholds:
    high: 7.0       # score >= 7.0
    medium: 4.0     # score >= 4.0 and < 7.0
    # below 4.0 = low

  # Auto-generation limits
  max_auto_questions: 50
  dedup_similarity_threshold: 0.85    # SHA-256 content hash dedup

  # Question status transitions (state machine)
  question_transitions:
    draft: [approved]
    approved: [submitted, draft]
    submitted: [answered]
    answered: []

  # Export settings (D-QTG-4 — HTML for government submission)
  export:
    format: html
    include_cui_banner: true
    include_priority: true
    include_rfp_reference: true
    default_company_name: "ICDEV"

  # Amendment diff settings (D-QTG-3 — Python stdlib difflib)
  amendment_diff:
    context_lines: 3
    ignore_whitespace: false
