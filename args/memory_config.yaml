# [TEMPLATE: CUI // SP-CTI]
# Memory System Configuration — time-decay, dedup, auto-capture, maintenance
# (D147, D179-D182)
---

time_decay:
  # Exponential decay formula: decay_factor = 2^(-(age_days / half_life_days))
  # Per-type half-lives (in days)
  half_lives:
    fact: 90          # Long-lived — organizational knowledge
    preference: 180   # Very long-lived — user/system preferences rarely change
    event: 7          # Short-lived — session events lose relevance quickly
    insight: 30       # Medium — insights remain useful for ~1 month
    task: 14          # Short-medium — task context relevant during sprint
    relationship: 120 # Long-lived — people/system relationships persist
    thinking: 3       # Very short — reasoning traces decay rapidly (D182)

  # Default half-life for unknown memory types
  default_half_life: 30

  # Minimum decay factor (prevents ancient entries from being completely zeroed)
  min_decay_factor: 0.01

  # Scoring weights when time-decay is enabled (must sum to 1.0)
  weights:
    relevance: 0.60    # BM25 + semantic hybrid score
    recency: 0.25      # Time decay factor
    importance: 0.15   # Normalized importance (importance / 10.0)

  # Override: if importance >= this threshold, halve the decay effect
  # (very important memories resist decay)
  importance_decay_resistance_threshold: 8

# Content deduplication (D179)
deduplication:
  enabled: true
  hash_algorithm: "sha256"    # SHA-256 content hash before INSERT

# Auto-capture settings (D181)
auto_capture:
  enabled: true
  buffer_flush_threshold: 100   # Flush when buffer exceeds this count
  default_importance: 3         # Importance for auto-captured entries
  max_content_length: 2000      # Truncate captured content to this length

# Maintenance pipeline settings (D179-D182)
maintenance:
  enabled: true
  prune_stale_days: 180         # Prune low-importance entries older than this
  prune_min_importance: 3       # Only prune entries with importance <= this
  prune_types:                  # Only prune these memory types
    - event
    - thinking
  embed_batch_size: 20          # Batch size for embedding generation
  backup_before_prune: true     # Backup memory.db before pruning

# History compression (Phase 44 — D271-D274)
history_compression:
  enabled: true                   # Opt-in per context
  budget_allocation:
    current_topic: 0.50           # 50% of budget for current topic
    historical_topics: 0.30       # 30% for historical summaries
    bulk: 0.20                    # 20% for bulk merged content
  topic_detection:
    time_gap_minutes: 30          # Gap > 30min = new topic boundary
    keyword_shift_threshold: 0.60 # Keyword overlap < 40% = new topic
  summarization:
    llm_function: "history_summarize"
    fallback: "truncation"        # Use truncation when LLM unavailable
    max_summary_tokens: 200       # Max tokens per topic summary

# Memory consolidation (Phase 44 — D276)
consolidation:
  enabled: true
  similarity_threshold: 0.75     # Minimum similarity to trigger consolidation
  use_llm: true                  # Use LLM for merge/replace decisions
  llm_function: "memory_consolidation"
  max_candidates: 5              # Max similar entries to consider
  batch_size: 50                 # Batch size for consolidate_all()
  actions:
    jaccard_skip: 0.90            # Jaccard >= 0.90 → SKIP (near-duplicate)
    jaccard_replace: 0.80         # Jaccard >= 0.80 → REPLACE
    jaccard_keep: 0.75            # Jaccard >= 0.75 → KEEP_SEPARATE
